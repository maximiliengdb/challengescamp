{% extends "CC/base.html" %}
{% block content %}
{% load staticfiles %}

{% include "CC/naviguation.html" %}

        <div class="content">
            <div class="container-fluid" style="margin-bottom : 70px;">

                    <style>
                        #fly {
                            display: block;
                            position: relative;
                            margin: -100px 20px;
                            width: 50px;
                            height: 50px;
                            padding: 10px;
                            border: none;
                            border-radius: 3px;
                            font-size: 12px;
                            text-align: center;
                            color: #fff;
                            background: #ee8a65;
                        }
                    </style>
                    
                    <div class="row" style="margin-bottom : 2%;">
                        <div class="col-xs-6">
                            <a type="button" class="btn btn-primary btn-block" href="/compte/proposition_defi">Proposer un DÃ©fi</a>
                        </div>
                        <div class="col-xs-6">
                                <a type="button" class="btn btn-primary btn-block" href="/compte/proposition_point">Proposer un Point</a>
                        </div>
                        
                    </div>
                    <div id='map' style='width: auto; height: 550px;'>
                    
                    </div>
             </div>
        </div>


{% block javascript %}
<script>

    var options = {
        enableHighAccuracy: true,
        timeout: 2000,
        maximumAge: 0
        };
    
    
    function success(pos) {
        crd = pos.coords;
        $.ajax({url: '/user_position_push/?id_user={{utilisateur.id}}&latitude='+crd.latitude+'&longitude='+crd.longitude,
                });
        };
    
    
    function error(err) {
        console.warn(`ERROR(${err.code}): ${err.message}`);
        };
        
    id = navigator.geolocation.watchPosition(success, error, options);

    var map = L.map('map').setView([{{utilisateur.latitude}}, {{utilisateur.longitude}}], 17);
    
    L.tileLayer('https://{s}.tile.openstreetmap.se/hydda/full/{z}/{x}/{y}.png', {
        maxZoom: 18,
        minZoom: 14,
    }).addTo(map);

    var lc = L.control.locate({
        strings: {
            title: "Show me where I am, yo!"
        },
        flyto : 'True',
    }).addTo(map);

    var LeafIcon = L.Icon.extend({
        options: {
            iconSize: [34, 53],
        }
    });

    var sportIcon = new LeafIcon({iconUrl: '{{icone_sport.image.url}}'}); 

    {% for point in points_sport %}
    L.marker([{{point.y}},{{point.x}}], {icon: sportIcon}).addTo(map)
        .bindPopup('{{point.defi.description}}')
        .openPopup();
    {% endfor %}


    $('.nbre_notification').click(function () {
            $.ajax({
            url: '/compte/vue_notification/',
            });
            $("#notifications").load("/compte/vestiaire/ #notifications");
            $("#notificationspetit").load("/compte/vestiaire/ #notificationspetit");
        });
        
    $('div.block_notification').click(function () {
        var id = $(this).attr('value');
        $.ajax({
        url: '/compte/active_notification/?notif_id='+id
        });
    });
</script>
{% endblock %}

{% endblock %}